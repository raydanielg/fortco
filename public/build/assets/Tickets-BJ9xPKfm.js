import{b as q,r as a,j as e,H as X}from"./app-_tcWvRHw.js";import{A as L}from"./AdminPanelLayout-0PjPupQC.js";import"./DashboardLayout-Dotb40vo.js";import"./AnimatedIcon-D_as9RWF.js";import"./index-D3vds0s7.js";import"./index-DoyJDsUh.js";function K(){const o=q().props.auth?.user,[N,i]=a.useState(!1),[f,n]=a.useState(""),[x,S]=a.useState([]),[c,T]=a.useState(""),[H,O]=a.useState([]),[l,R]=a.useState(""),[d,A]=a.useState(null),[b,j]=a.useState([]),[u,v]=a.useState(""),p=a.useRef(null),y=()=>document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",m=async t=>{const s=await t.text();try{return s?JSON.parse(s):{}}catch{return{}}},h=()=>{i(!0),n(""),fetch(route("support.tickets.data",{q:c}),{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(async t=>{const s=await m(t);if(!t.ok)throw new Error(s?.message||"Failed to load tickets");S(Array.isArray(s?.tickets)?s.tickets:[])}).catch(t=>n(t?.message||"Failed to load tickets")).finally(()=>i(!1))},g=t=>{t&&(i(!0),n(""),fetch(route("support.tickets.show",{ticket:t}),{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(async s=>{const r=await m(s);if(!s.ok)throw new Error(r?.message||"Failed to load ticket");A(r?.ticket||null),j(Array.isArray(r?.messages)?r.messages:[])}).catch(s=>n(s?.message||"Failed to load ticket")).finally(()=>i(!1)))},k=()=>{const t=u.trim();if(!t||!l)return;const s={id:`tmp-${Date.now()}`,message:t,created_at:new Date().toISOString(),user:{id:o?.id,name:o?.name,email:o?.email}};j(r=>[...r,s]),v(""),i(!0),fetch(route("support.tickets.messages.store",{ticket:l}),{method:"POST",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":y(),Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({message:t})}).then(async r=>{const w=await m(r);if(!r.ok)throw new Error(w?.message||w?.errors?.message?.[0]||"Failed");g(l),h()}).catch(r=>n(r?.message||"Failed to send")).finally(()=>i(!1))},C=t=>{l&&(i(!0),fetch(route("support.tickets.status",{ticket:l}),{method:"PUT",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":y(),Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({status:t})}).then(async s=>{if(!s.ok)throw new Error("Failed");g(l),h()}).catch(s=>n(s?.message||"Failed")).finally(()=>i(!1)))};a.useEffect(()=>{h()},[]),a.useEffect(()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight)},[b.length]);const F=a.useMemo(()=>{const t=c.trim().toLowerCase();return t?x.filter(s=>String(s?.subject||"").toLowerCase().includes(t)):x},[x,c]),E=[{key:"tickets",label:"Tickets",href:route("admin.support.tickets")},{key:"live-chat",label:"Live Chat",href:route("admin.support.live-chat")},{key:"knowledge-base",label:"Knowledge Base",href:route("admin.support.knowledge-base")},{key:"helpdesk-messages",label:"Helpdesk Messages",href:route("admin.support.helpdesk-messages")}];return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Support - Tickets"}),e.jsxs(L,{title:"Support",active:"tickets",items:E,children:[e.jsxs("div",{className:"border-b border-slate-200 px-6 py-4",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Manage Tickets"}),e.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:"View and manage all system support tickets."})]}),e.jsxs("div",{className:"p-6",children:[f?e.jsx("div",{className:"mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-[12px] text-red-700",children:f}):null,e.jsxs("div",{className:"grid gap-4 overflow-hidden rounded-2xl border border-slate-200 bg-white lg:grid-cols-[380px,1fr]",children:[e.jsxs("div",{className:"border-b border-slate-200 lg:border-b-0 lg:border-r",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-slate-100",children:[e.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:"All Tickets"}),e.jsx("input",{value:c,onChange:t=>T(t.target.value),placeholder:"Search tickets...",className:"mt-2 w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-[12px]"})]}),e.jsx("div",{className:"max-h-[620px] overflow-auto p-2",children:F.map(t=>e.jsx("button",{onClick:()=>{R(String(t.id)),g(String(t.id))},className:`w-full rounded-xl px-3 py-3 text-left transition ${String(t.id)===l?"bg-slate-50":"hover:bg-slate-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-[12px] font-semibold text-slate-900",children:t.subject}),e.jsxs("div",{className:"mt-1 text-[11px] text-slate-500",children:["From: ",t.creator?.name]})]}),e.jsx("div",{className:`rounded-full px-2 py-0.5 text-[10px] font-bold uppercase ${t.status==="open"?"bg-blue-100 text-blue-700":"bg-emerald-100 text-emerald-700"}`,children:t.status})]})},t.id))})]}),e.jsx("div",{className:"flex min-h-[620px] flex-col",children:d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b border-slate-200 px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:d.subject}),e.jsxs("div",{className:"text-[11px] text-slate-500",children:["Status: ",d.status]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:d.status,onChange:t=>C(t.target.value),className:"rounded-lg border border-slate-200 bg-white px-2 py-1 text-[11px] font-semibold",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"closed",children:"Closed"})]})})]}),e.jsx("div",{ref:p,className:"flex-1 overflow-auto bg-slate-50 p-4",children:b.map(t=>e.jsx("div",{className:`flex ${String(t.user?.id)===String(o?.id)?"justify-end":"justify-start"} mb-2`,children:e.jsxs("div",{className:`max-w-[85%] rounded-2xl px-4 py-3 text-[12px] ${String(t.user?.id)===String(o?.id)?"bg-slate-900 text-white":"bg-white text-slate-900 shadow-sm"}`,children:[e.jsx("div",{className:"font-bold text-[10px] mb-1 opacity-70",children:t.user?.name}),e.jsx("div",{children:t.message}),e.jsx("div",{className:"mt-1 text-[10px] opacity-50",children:new Date(t.created_at).toLocaleString()})]})},t.id))}),e.jsx("div",{className:"border-t border-slate-200 bg-white p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:u,onChange:t=>v(t.target.value),placeholder:"Write a reply...",className:"w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-[12px]",onKeyDown:t=>t.key==="Enter"&&k()}),e.jsx("button",{onClick:k,disabled:N||!u.trim(),className:"rounded-xl bg-emerald-500 px-4 py-2 text-[12px] font-semibold text-white hover:bg-emerald-600",children:"Send"})]})})]}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-slate-500 text-[12px]",children:"Select a ticket to view conversation"})})]})]})]})]})}export{K as default};
