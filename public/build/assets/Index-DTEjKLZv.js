import{r as o,j as e,H as N}from"./app-_tcWvRHw.js";import{D as y}from"./DashboardLayout-Dotb40vo.js";import{B as w,C as _,a as k,b as S,e as D,p as H,f as F}from"./index-CWinhnPK.js";import{i as $,j as C,k as E,F as R}from"./index-BXI-ogw4.js";import"./AnimatedIcon-D_as9RWF.js";import"./index-D3vds0s7.js";import"./index-DoyJDsUh.js";import"./iconBase-axut_MbO.js";_.register(k,S,D,H,F);function L({ok:t,text:i}){return e.jsx("div",{className:`inline-flex items-center rounded-full border px-2 py-1 text-[11px] font-semibold ${t?"border-emerald-200 bg-emerald-50 text-emerald-800":"border-rose-200 bg-rose-50 text-rose-700"}`,children:i})}function b({title:t,icon:i,ok:c,ms:m,message:x}){return e.jsx("div",{className:"h-full rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`mt-0.5 inline-flex h-9 w-9 items-center justify-center rounded-full border ${c?"border-emerald-200 bg-emerald-50 text-emerald-800":"border-rose-200 bg-rose-50 text-rose-700"}`,children:e.jsx(i,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:t}),e.jsx("div",{className:"mt-1 text-[11px] text-slate-500",children:x||""})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(L,{ok:c,text:c?"Healthy":"Fail"}),e.jsx("div",{className:"mt-2 text-[11px] text-slate-500",children:m!==null?`${m}ms`:""})]})]})})}function s({label:t,value:i}){return e.jsxs("div",{className:"flex items-center justify-between gap-3 border-b border-slate-100 py-2 last:border-b-0",children:[e.jsx("div",{className:"text-[12px] text-slate-600",children:t}),e.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:i})]})}function J(){const[t,i]=o.useState(null),[c,m]=o.useState(!1),[x,j]=o.useState(""),h=o.useRef(null),a=t?.checks||{},l=t?.queue||{},r=t?.sessions||{},d=t?.runtime||{},p=o.useMemo(()=>({labels:["Jobs","Failed Jobs","Sessions","Active Sessions (15m)"],datasets:[{label:"Counts",data:[l.jobs??0,l.failed_jobs??0,r.total??0,r.active_15m??0],backgroundColor:["#0ea5e9","#ef4444","#64748b","#10b981"],borderWidth:0}]}),[l.jobs,l.failed_jobs,r.total,r.active_15m]),f=o.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}},scales:{x:{grid:{display:!1}},y:{beginAtZero:!0,ticks:{precision:0}}}}),[]);return o.useEffect(()=>{let u=!0;const v=async()=>{m(!0),j("");try{const n=await fetch(route("admin.system-health.data"),{headers:{Accept:"application/json"}});if(!n.ok)throw new Error(`HTTP ${n.status}`);const g=await n.json();u&&i(g)}catch(n){u&&j(String(n?.message||n||"Failed to load system health"))}finally{u&&m(!1)}};return v(),h.current=setInterval(v,1e4),()=>{u=!1,h.current&&clearInterval(h.current)}},[]),e.jsxs(y,{title:"System Health",breadcrumbs:["Home","System Health"],children:[e.jsx(N,{title:"System Health"}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-slate-900",children:"System Health"}),e.jsx("div",{className:"mt-1 text-[12px] text-slate-600",children:"Live health checks for database, cache, queue and sessions."})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:c?"Updatingâ€¦":x?"Offline":"Online"}),e.jsx("div",{className:"mt-1 text-[11px] text-slate-500",children:"Refresh interval: 10s"})]})]}),x?e.jsx("div",{className:"mt-4 rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-[12px] text-rose-700",children:x}):null]}),e.jsxs("div",{className:"grid auto-rows-fr gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(b,{title:"Database",icon:$,ok:!!a.db?.ok,ms:a.db?.ms??null,message:a.db?.message||""}),e.jsx(b,{title:"Cache",icon:C,ok:!!a.cache?.ok,ms:a.cache?.ms??null,message:a.cache?.message||""}),e.jsx(b,{title:"Queue",icon:E,ok:!!a.queue?.ok,ms:null,message:a.queue?.message||`Driver: ${l.driver||"-"}`}),e.jsx(b,{title:"Sessions",icon:R,ok:!!a.sessions?.ok,ms:null,message:a.sessions?.message||`Driver: ${r.driver||"-"}`})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm lg:col-span-2",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Operational counters"}),e.jsx("div",{className:"mt-1 text-[12px] text-slate-600",children:"Queue and session counters."}),e.jsx("div",{className:"mt-5 h-[320px]",children:e.jsx(w,{data:p,options:f})})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Runtime"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(s,{label:"PHP",value:d.php_version||"-"}),e.jsx(s,{label:"Laravel",value:d.laravel_version||"-"}),e.jsx(s,{label:"Env",value:d.app_env||"-"}),e.jsx(s,{label:"Debug",value:d.app_debug?"true":"false"}),e.jsx(s,{label:"Timezone",value:d.timezone||"-"}),e.jsx(s,{label:"Memory usage",value:`${d.memory_usage_mb??0} MB`}),e.jsx(s,{label:"Memory peak",value:`${d.memory_peak_mb??0} MB`})]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Queue details"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(s,{label:"Driver",value:l.driver||"-"}),e.jsx(s,{label:"Jobs",value:l.jobs??0}),e.jsx(s,{label:"Failed jobs",value:l.failed_jobs??0})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Sessions details"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(s,{label:"Driver",value:r.driver||"-"}),e.jsx(s,{label:"Total",value:r.total??0}),e.jsx(s,{label:"Active (15m)",value:r.active_15m??0})]})]})]})]})]})}export{J as default};
