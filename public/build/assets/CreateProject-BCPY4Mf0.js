import{r as o,j as t,H as k,L as S}from"./app-_tcWvRHw.js";import{C as R}from"./ConstructionPanelLayout-smiwN9nJ.js";import"./DashboardLayout-Dotb40vo.js";import"./AnimatedIcon-D_as9RWF.js";import"./index-D3vds0s7.js";import"./index-DoyJDsUh.js";function X(){const[g,x]=o.useState(!1),[u,n]=o.useState(""),[j,p]=o.useState([]),[f,m]=o.useState([]),[s,r]=o.useState({code:"",category_id:"",location_id:"",name:"",status:"planned",start_date:"",end_date:"",budget:"",description:""}),[h,i]=o.useState([""]),v=()=>document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",c=async e=>{const a=await e.text();try{return a?JSON.parse(a):{}}catch{return{}}},y=[{value:"planned",label:"Planned"},{value:"in_progress",label:"In progress"},{value:"on_hold",label:"On hold"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}];o.useEffect(()=>{fetch(route("admin.construction.project-categories.data"),{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(async e=>{const a=await c(e);if(!e.ok)throw new Error(a?.message||"Failed to load categories");p(Array.isArray(a?.categories)?a.categories:[])}).catch(()=>p([])),fetch(route("admin.construction.locations.data"),{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(async e=>{const a=await c(e);if(!e.ok)throw new Error(a?.message||"Failed to load locations");m(Array.isArray(a?.locations)?a.locations:[])}).catch(()=>m([]))},[]);const w=()=>{i(e=>[...e,""])},N=e=>{i(a=>{const l=a.filter((b,d)=>d!==e);return l.length?l:[""]})},C=(e,a)=>{i(l=>l.map((b,d)=>d===e?a:b))},_=()=>{if(!s.name){n("Project name is required");return}x(!0),n(""),fetch(route("admin.construction.projects.store"),{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":v(),Accept:"application/json"},body:JSON.stringify({...s,category_id:s.category_id?Number(s.category_id):null,location_id:s.location_id?Number(s.location_id):null,features:h.map(e=>String(e||"").trim()).filter(Boolean),budget:s.budget!==""?Number(s.budget):null,start_date:s.start_date||null,end_date:s.end_date||null,code:s.code||null,description:s.description||null})}).then(async e=>{const a=await c(e);if(!e.ok)throw new Error(a?.message||"Failed to create project");window.location.href=route("admin.construction.projects")}).catch(e=>n(e?.message||"Failed to create project")).finally(()=>x(!1))};return t.jsxs(R,{title:"Construction",active:"create",items:[{key:"projects",label:"Projects",href:route("admin.construction.projects")},{key:"create",label:"Create Projects",href:route("admin.construction.projects.create")},{key:"categories",label:"Project Categories",href:route("admin.construction.project-categories")},{key:"locations",label:"Locations",href:route("admin.construction.locations")},{key:"materials",label:"Materials",href:route("admin.construction.materials")},{key:"workers",label:"Workers",href:route("admin.construction.workers")}],children:[t.jsx(k,{title:"Create Project"}),t.jsxs("div",{className:"border-b border-slate-200 px-6 py-4",children:[t.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Create project"}),t.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:"Add a new construction project and save to database."})]}),t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Create new project"}),t.jsx("div",{className:"mt-1 text-[12px] text-slate-600",children:"Fill the details then save."})]}),t.jsx(S,{href:route("admin.construction.projects"),className:"inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-4 py-2 text-[12px] font-semibold text-slate-900 shadow-sm hover:bg-slate-50",children:"Back to list"})]}),u?t.jsx("div",{className:"mt-4 rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-[12px] text-rose-700",children:u}):null,t.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Code (auto-generated)"}),t.jsx("input",{value:s.code,onChange:e=>r(a=>({...a,code:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]",placeholder:"Leave empty to auto-generate"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Status"}),t.jsx("select",{value:s.status,onChange:e=>r(a=>({...a,status:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]",children:y.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Category"}),t.jsxs("select",{value:s.category_id,onChange:e=>r(a=>({...a,category_id:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]",children:[t.jsx("option",{value:"",children:"Select category"}),j.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Location"}),t.jsxs("select",{value:s.location_id,onChange:e=>r(a=>({...a,location_id:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]",children:[t.jsx("option",{value:"",children:"Select location"}),f.map(e=>t.jsxs("option",{value:e.id,children:[e.name,e.region?`, ${e.region}`:"",e.country?`, ${e.country}`:""]},e.id))]})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Project name *"}),t.jsx("input",{value:s.name,onChange:e=>r(a=>({...a,name:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]",placeholder:"e.g. Edmark Residential Estate"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Start date"}),t.jsx("input",{type:"date",value:s.start_date,onChange:e=>r(a=>({...a,start_date:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"End date"}),t.jsx("input",{type:"date",value:s.end_date,onChange:e=>r(a=>({...a,end_date:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Budget"}),t.jsx("input",{value:s.budget,onChange:e=>r(a=>({...a,budget:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]",placeholder:"e.g. 4500000000"})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Key features"}),t.jsxs("div",{className:"mt-2 grid gap-2",children:[h.map((e,a)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{value:e,onChange:l=>C(a,l.target.value),className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]",placeholder:"e.g. 25 Luxury Villas"}),t.jsx("button",{type:"button",onClick:()=>N(a),className:"inline-flex h-9 w-9 items-center justify-center rounded-xl border border-slate-200 bg-white text-[12px] font-semibold text-slate-700 hover:bg-slate-50","aria-label":"Remove",children:"âˆ’"})]},a)),t.jsx("button",{type:"button",onClick:w,className:"inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px] font-semibold text-slate-900 hover:bg-slate-50",children:"Add feature"})]})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Description"}),t.jsx("textarea",{value:s.description,onChange:e=>r(a=>({...a,description:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]",rows:5,placeholder:"Write a clear project description..."})]})]}),t.jsx("div",{className:"mt-6 flex items-center justify-end gap-2",children:t.jsx("button",{type:"button",onClick:_,disabled:g,className:"inline-flex items-center justify-center rounded-xl bg-slate-900 px-5 py-2.5 text-[12px] font-semibold text-white shadow-sm hover:bg-slate-800 disabled:opacity-60",children:"Create project"})})]})]})}export{X as default};
