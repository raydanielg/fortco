import{r as n,j as e,H as F}from"./app-_tcWvRHw.js";import{A as C}from"./AdminPanelLayout-0PjPupQC.js";import"./DashboardLayout-Dotb40vo.js";import"./AnimatedIcon-D_as9RWF.js";import"./index-D3vds0s7.js";import"./index-DoyJDsUh.js";function M(){const[v,l]=n.useState(!1),[h,i]=n.useState(""),[d,w]=n.useState([]),[a,c]=n.useState(""),[u,S]=n.useState([]),[f,E]=n.useState([]),[x,b]=n.useState("sessions"),o=async s=>{const t=await s.text();try{return t?JSON.parse(t):{}}catch{return{}}},y=()=>{l(!0),i(""),fetch(route("admin.security.users"),{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(async s=>{const t=await o(s);if(!s.ok)throw new Error(t?.message||"Failed to load users");const r=Array.isArray(t?.users)?t.users:[];w(r);const p=(()=>{try{return new URLSearchParams(window.location.search).get("user")||""}catch{return""}})();a||(p&&r.some(q=>String(q.id)===String(p))?c(String(p)):r[0]?.id&&c(String(r[0].id)))}).catch(s=>i(s?.message||"Failed to load users")).finally(()=>l(!1))},m=s=>{s&&(l(!0),i(""),fetch(route("admin.security.users.sessions",{user:s}),{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(async t=>{const r=await o(t);if(!t.ok)throw new Error(r?.message||"Failed to load sessions");S(Array.isArray(r?.sessions)?r.sessions:[])}).catch(t=>i(t?.message||"Failed to load sessions")).finally(()=>l(!1)))},g=s=>{s&&(l(!0),i(""),fetch(route("admin.security.users.logs",{user:s,limit:120}),{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(async t=>{const r=await o(t);if(!t.ok)throw new Error(r?.message||"Failed to load logs");E(Array.isArray(r?.logs)?r.logs:[])}).catch(t=>i(t?.message||"Failed to load logs")).finally(()=>l(!1)))};n.useEffect(()=>{y()},[]),n.useEffect(()=>{a&&(m(a),g(a))},[a]);const j=n.useMemo(()=>d.find(s=>String(s.id)===String(a))||null,[d,a]),L=()=>{a&&window.confirm("Clear ALL sessions for this user?")&&(l(!0),i(""),fetch(route("admin.security.users.sessions.clear",{user:a}),{method:"DELETE",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"}}).then(async s=>{const t=await o(s);if(!s.ok)throw new Error(t?.message||"Failed to clear sessions");m(a)}).catch(s=>i(s?.message||"Failed to clear sessions")).finally(()=>l(!1)))},k=s=>{!a||!s||window.confirm("Delete this session?")&&(l(!0),i(""),fetch(route("admin.security.users.sessions.delete",{user:a,sessionId:s}),{method:"DELETE",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"}}).then(async t=>{const r=await o(t);if(!t.ok)throw new Error(r?.message||"Failed to delete session");m(a)}).catch(t=>i(t?.message||"Failed to delete session")).finally(()=>l(!1)))},N=s=>"inline-flex items-center border-b-2 px-4 py-3 text-[12px] font-semibold transition "+(s?"border-slate-900 text-slate-900":"border-transparent text-slate-500 hover:text-slate-900"),A=n.useMemo(()=>[{key:"users",label:"Users",href:route("admin.user-management.users")},{key:"employees",label:"Employees",href:route("admin.user-management.employees")},{key:"roles",label:"Roles",href:route("admin.user-management.roles")},{key:"permissions",label:"Permissions",href:route("admin.user-management.permissions")},{key:"sessions-logs",label:"Sessions & Logs",href:route("admin.user-management.sessions-logs")}],[]);return e.jsxs(e.Fragment,{children:[e.jsx(F,{title:"Sessions & Logs"}),e.jsx(C,{title:"User Management",active:"sessions-logs",items:A,children:e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white",children:[e.jsxs("div",{className:"border-b border-slate-200 px-6 py-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Sessions & Logs"}),e.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:"View sessions/devices and recent HTTP request logs per user."})]}),e.jsx("div",{className:"text-[12px] text-slate-500",children:v?"Workingâ€¦":""})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-2",children:[e.jsx("select",{value:a,onChange:s=>c(s.target.value),className:"w-full max-w-md rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-[12px] text-slate-900 focus:border-primary-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-primary-500/20",children:d.map(s=>e.jsxs("option",{value:String(s.id),children:[s.name," (",s.email,")"]},s.id))}),e.jsx("button",{type:"button",onClick:()=>{y()},className:"rounded-xl border border-slate-200 bg-white px-4 py-2 text-[12px] font-semibold text-slate-700 hover:bg-slate-50",children:"Refresh users"})]}),j?e.jsxs("div",{className:"mt-3 text-[12px] text-slate-600",children:["Selected: ",e.jsx("span",{className:"font-semibold text-slate-900",children:j.name})]}):null,e.jsxs("div",{className:"mt-4 flex items-center gap-1 px-2",children:[e.jsx("button",{type:"button",onClick:()=>b("sessions"),className:N(x==="sessions"),children:"Sessions"}),e.jsx("button",{type:"button",onClick:()=>b("logs"),className:N(x==="logs"),children:"Logs"})]})]}),e.jsxs("div",{className:"p-6",children:[h?e.jsx("div",{className:"mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-[12px] text-red-700",children:h}):null,x==="sessions"?e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 flex items-center justify-end",children:e.jsx("button",{type:"button",onClick:L,className:"rounded-xl border border-red-200 bg-white px-4 py-2 text-[12px] font-semibold text-red-700 hover:bg-red-50",children:"Clear all sessions"})}),e.jsx("div",{className:"overflow-auto rounded-xl border border-slate-200",children:e.jsxs("table",{className:"min-w-full text-left text-[12px]",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Session ID"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"IP"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"User Agent"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Last Activity"}),e.jsx("th",{className:"px-4 py-3 font-semibold"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:u.length?u.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-mono text-[11px] text-slate-900 break-all",children:s.id}),e.jsx("td",{className:"px-4 py-3 text-slate-700",children:s.ip_address||"-"}),e.jsx("td",{className:"px-4 py-3 text-slate-700 max-w-[380px] truncate",children:s.user_agent||"-"}),e.jsx("td",{className:"px-4 py-3 text-slate-700",children:s.last_activity?new Date(s.last_activity).toLocaleString():"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{type:"button",onClick:()=>k(s.id),className:"rounded-xl border border-red-200 bg-white px-3 py-2 text-[12px] font-semibold text-red-700 hover:bg-red-50",children:"Delete"})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-6 text-slate-500",children:"No sessions found."})})})]})}),e.jsxs("div",{className:"mt-4 text-[12px] text-slate-500",children:["Note: session management actions require ",e.jsx("span",{className:"font-semibold text-slate-700",children:"SESSION_DRIVER=database"}),"."]})]}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 flex items-center justify-end gap-2",children:e.jsx("button",{type:"button",onClick:()=>g(a),className:"rounded-xl border border-slate-200 bg-white px-4 py-2 text-[12px] font-semibold text-slate-700 hover:bg-slate-50",children:"Refresh logs"})}),e.jsx("div",{className:"overflow-auto rounded-xl border border-slate-200",children:e.jsxs("table",{className:"min-w-full text-left text-[12px]",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-semibold",children:"At"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Method"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Path"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Duration"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"IP"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:f.length?f.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-slate-700",children:s.at?new Date(s.at).toLocaleString():"-"}),e.jsx("td",{className:"px-4 py-3 font-mono text-[11px] text-slate-900",children:s.method||"-"}),e.jsx("td",{className:"px-4 py-3 font-mono text-[11px] text-slate-700 break-all",children:s.path||"-"}),e.jsx("td",{className:"px-4 py-3 text-slate-700",children:s.status??"-"}),e.jsx("td",{className:"px-4 py-3 text-slate-700",children:s.duration_ms!=null?`${s.duration_ms} ms`:"-"}),e.jsx("td",{className:"px-4 py-3 text-slate-700",children:s.ip||"-"})]},t)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-6 text-slate-500",children:"No logs found."})})})]})}),e.jsx("div",{className:"mt-4 text-[12px] text-slate-500",children:"Logs are read from server log and filtered by user_id (HTTP_REQUEST entries)."})]})]})]})})]})}export{M as default};
