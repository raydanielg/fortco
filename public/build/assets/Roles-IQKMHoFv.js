import{r as a,j as e,H as A}from"./app-Be5uCMNC.js";import{D as k}from"./DashboardLayout-BxHtKg-F.js";function M(){const[c,n]=a.useState(!1),[h,l]=a.useState(""),[m,v]=a.useState([]),[N,w]=a.useState([]),[f,g]=a.useState(""),[i,b]=a.useState(""),[x,j]=a.useState(()=>new Set),y="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-[12px] text-slate-900 focus:border-primary-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-primary-500/20",p=async s=>{const t=await s.text();try{return t?JSON.parse(t):{}}catch{return{}}},d=()=>{n(!0),l(""),fetch(route("admin.role-permission.data"),{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(async s=>{const t=await p(s);if(!s.ok)throw new Error(t?.message||"Failed to load roles");const r=Array.isArray(t?.roles)?t.roles:[],o=Array.isArray(t?.permissions)?t.permissions:[];v(r),w(o),!i&&r[0]?.id&&b(String(r[0].id))}).catch(s=>l(s?.message||"Failed to load roles")).finally(()=>n(!1))};a.useEffect(()=>{d()},[]);const u=a.useMemo(()=>m.find(s=>String(s.id)===String(i))||null,[m,i]);a.useEffect(()=>{const s=new Set(Array.isArray(u?.permission_names)?u.permission_names:[]);j(s)},[i,u]);const S=()=>{const s=f.trim();s&&(n(!0),l(""),fetch(route("admin.role-permission.roles.store"),{method:"POST",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({name:s})}).then(async t=>{const r=await p(t);if(!t.ok)throw new Error(r?.message||r?.errors?.name?.[0]||"Create role failed");g(""),d()}).catch(t=>l(t?.message||"Create role failed")).finally(()=>n(!1)))},R=()=>{i&&(n(!0),l(""),fetch(route("admin.role-permission.roles.permissions.sync",{role:i}),{method:"PUT",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({permissions:Array.from(x)})}).then(async s=>{const t=await p(s);if(!s.ok)throw new Error(t?.message||"Save failed");d()}).catch(s=>l(s?.message||"Save failed")).finally(()=>n(!1)))};return e.jsxs(k,{title:"User Management",breadcrumbs:["Admin","User Management","Roles"],children:[e.jsx(A,{title:"Roles"}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white",children:[e.jsx("div",{className:"border-b border-slate-200 px-6 py-4",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Roles"}),e.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:"Create roles and assign permissions."})]}),e.jsx("div",{className:"text-[12px] text-slate-500",children:c?"Workingâ€¦":""})]})}),e.jsxs("div",{className:"p-6",children:[h?e.jsx("div",{className:"mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-[12px] text-red-700",children:h}):null,e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-5",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Add Role"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wider text-slate-500",children:"Role name"}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{value:f,onChange:s=>g(s.target.value),className:y,placeholder:"e.g. Manager"})})]}),e.jsx("button",{type:"button",onClick:S,disabled:c,className:"mt-4 inline-flex w-full items-center justify-center rounded-xl bg-slate-900 px-5 py-2.5 text-[12px] font-semibold text-white hover:bg-slate-800 disabled:opacity-50",children:"Add"})]}),e.jsx("button",{type:"button",onClick:d,className:"mt-4 inline-flex w-full items-center justify-center rounded-xl border border-slate-200 bg-white px-5 py-2.5 text-[12px] font-semibold text-slate-700 hover:bg-slate-50",children:"Refresh"})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white",children:[e.jsxs("div",{className:"border-b border-slate-200 px-5 py-4",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Manage Role"}),e.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:"Select role and update permissions."})]}),e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wider text-slate-500",children:"Role"}),e.jsx("div",{className:"mt-2",children:e.jsx("select",{value:i,onChange:s=>b(s.target.value),className:y,children:m.map(s=>e.jsx("option",{value:String(s.id),children:s.name},s.id))})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wider text-slate-500",children:"Permissions"}),e.jsx("div",{className:"mt-2 grid gap-2 md:grid-cols-2",children:N.map(s=>{const t=String(s.name),r=x.has(t);return e.jsxs("label",{className:"flex items-start gap-3 rounded-xl border border-slate-200 bg-white p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-1 h-4 w-4 rounded border-slate-300 text-primary-600 focus:ring-primary-500",checked:r,onChange:()=>{const o=new Set(x);o.has(t)?o.delete(t):o.add(t),j(o)}}),e.jsx("div",{className:"font-mono text-[12px] font-semibold text-slate-900",children:t})]},s.id)})}),e.jsx("div",{className:"mt-4 flex items-center justify-end",children:e.jsx("button",{type:"button",onClick:R,disabled:c||!i,className:"inline-flex items-center justify-center rounded-xl bg-emerald-600 px-5 py-2.5 text-[12px] font-semibold text-white hover:bg-emerald-500 disabled:opacity-50",children:"Save Permissions"})})]})]})})]}),e.jsx("div",{className:"mt-4 text-[12px] text-slate-500",children:"Tip: to delete roles/permissions, use the existing settings page or we can add delete actions here next."})]})]})]})]})]})}export{M as default};
