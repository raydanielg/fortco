import{r,j as e,H as re}from"./app-_tcWvRHw.js";import{C as le}from"./ConstructionPanelLayout-smiwN9nJ.js";import"./DashboardLayout-Dotb40vo.js";import"./AnimatedIcon-D_as9RWF.js";import"./index-D3vds0s7.js";import"./index-DoyJDsUh.js";function pe(){const[y,N]=r.useState("all"),[m,n]=r.useState(!1),[C,l]=r.useState(""),[S,P]=r.useState([]),[A,_]=r.useState(!0),[o,D]=r.useState(""),[L,E]=r.useState(!1),[v,G]=r.useState(null),[R,M]=r.useState([]),[O,H]=r.useState([]),[I,X]=r.useState([]),[f,W]=r.useState(""),[u,w]=r.useState({name:"",type:"company"}),[i,h]=r.useState({name:"",age:"",date_of_birth:"",nida:""}),[J,q]=r.useState(!1),[b,T]=r.useState(null),[c,g]=r.useState({status:"pending",expiry_date:"",notes:""}),x=()=>document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",d=async t=>{const s=await t.text();try{return s?JSON.parse(s):{}}catch{return{}}},K=r.useMemo(()=>[{key:"projects",label:"Projects",href:route("admin.construction.projects")},{key:"create",label:"Create Projects",href:route("admin.construction.projects.create")},{key:"categories",label:"Project Categories",href:route("admin.construction.project-categories")},{key:"locations",label:"Locations",href:route("admin.construction.locations")},{key:"materials",label:"Materials",href:route("admin.construction.materials")},{key:"workers",label:"Workers",href:route("admin.construction.workers")}],[]),F=r.useMemo(()=>({nida:"NIDA",id_passport:"ID/Passport",work_permit:"Work Permit",safety_training:"Safety/Training"}),[]),U=t=>{const s=String(t||"pending");return s==="verified"?"border-emerald-200 bg-emerald-50 text-emerald-700":s==="rejected"?"border-rose-200 bg-rose-50 text-rose-700":"border-slate-200 bg-slate-50 text-slate-700"},B=t=>{const s=String(t||"pending");return s==="verified"?"bg-emerald-500":s==="rejected"?"bg-rose-500":"bg-amber-500 animate-pulse"},j=()=>{_(!0),l(""),fetch(route("admin.construction.workers.groups"),{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(async t=>{const s=await d(t);if(!t.ok)throw new Error(s?.message||"Failed to load groups");const a=Array.isArray(s?.groups)?s.groups:[];P(a),!o&&a.length&&D(String(a[0].id))}).catch(t=>l(t?.message||"Failed to load groups")).finally(()=>_(!1))},$=()=>{fetch(route("admin.construction.workers.projects"),{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(async t=>{const s=await d(t);if(!t.ok)throw new Error(s?.message||"Failed to load projects");X(Array.isArray(s?.projects)?s.projects:[])}).catch(()=>X([]))},p=t=>{t&&(E(!0),l(""),fetch(route("admin.construction.workers.groups.show",{group:t}),{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(async s=>{const a=await d(s);if(!s.ok)throw new Error(a?.message||"Failed to load group details");G(a?.group||null),M(Array.isArray(a?.workers)?a.workers:[]),H(Array.isArray(a?.projects)?a.projects:[]),W("")}).catch(s=>l(s?.message||"Failed to load group details")).finally(()=>E(!1)))};r.useEffect(()=>{j(),$()},[]),r.useEffect(()=>{o&&p(o)},[o]);const z=()=>{if(!u.name.trim()){l("Group name is required");return}n(!0),l(""),fetch(route("admin.construction.workers.groups.store"),{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":x(),Accept:"application/json"},body:JSON.stringify({name:u.name.trim(),type:u.type})}).then(async t=>{const s=await d(t);if(!t.ok)throw new Error(s?.message||"Failed to create group");w({name:"",type:"company"}),N("all"),j()}).catch(t=>l(t?.message||"Failed to create group")).finally(()=>n(!1))},V=()=>{if(o){if(!i.name.trim()){l("Worker name is required");return}n(!0),l(""),fetch(route("admin.construction.workers.store"),{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":x(),Accept:"application/json"},body:JSON.stringify({group_id:Number(o),name:i.name.trim(),age:i.age!==""?Number(i.age):null,date_of_birth:i.date_of_birth||null,nida:i.nida.trim()||null})}).then(async t=>{const s=await d(t);if(!t.ok)throw new Error(s?.message||"Failed to create worker");h({name:"",age:"",date_of_birth:"",nida:""}),p(o),j()}).catch(t=>l(t?.message||"Failed to create worker")).finally(()=>n(!1))}},Q=t=>{t?.id&&window.confirm(`Delete worker "${t.name}"?`)&&(n(!0),l(""),fetch(route("admin.construction.workers.destroy",{worker:t.id}),{method:"DELETE",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":x(),Accept:"application/json"}}).then(async s=>{const a=await d(s);if(!s.ok)throw new Error(a?.message||"Delete failed");p(o),j()}).catch(s=>l(s?.message||"Delete failed")).finally(()=>n(!1)))},Y=()=>{!o||!f||(n(!0),l(""),fetch(route("admin.construction.workers.groups.assign",{group:o}),{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":x(),Accept:"application/json"},body:JSON.stringify({project_id:Number(f)})}).then(async t=>{const s=await d(t);if(!t.ok)throw new Error(s?.message||"Assign failed");p(o)}).catch(t=>l(t?.message||"Assign failed")).finally(()=>n(!1)))},Z=t=>{!o||!t?.id||(n(!0),l(""),fetch(route("admin.construction.workers.groups.unassign",{group:o}),{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":x(),Accept:"application/json"},body:JSON.stringify({project_id:Number(t.id)})}).then(async s=>{const a=await d(s);if(!s.ok)throw new Error(a?.message||"Unassign failed");p(o)}).catch(s=>l(s?.message||"Unassign failed")).finally(()=>n(!1)))},ee=(t,s)=>{l(""),T({worker:t,doc:s}),g({status:s?.status||"pending",expiry_date:s?.expiry_date||"",notes:s?.notes||""}),q(!0)},k=()=>{q(!1),T(null),g({status:"pending",expiry_date:"",notes:""})},te=()=>{const t=b?.doc?.id;if(!t){l("Document record not found");return}n(!0),l(""),fetch(route("admin.construction.workers.documents.update",{document:t}),{method:"PUT",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":x(),Accept:"application/json"},body:JSON.stringify({status:c.status,expiry_date:c.expiry_date||null,notes:c.notes||null,file_path:b?.doc?.file_path||null})}).then(async s=>{const a=await d(s);if(!s.ok)throw new Error(a?.message||"Update failed");k(),p(o)}).catch(s=>l(s?.message||"Update failed")).finally(()=>n(!1))},se=e.jsx("div",{className:"grid gap-2 p-2",children:Array.from({length:8}).map((t,s)=>e.jsx("div",{className:"h-10 animate-pulse rounded-xl bg-slate-100"},s))}),ae=e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"h-6 w-52 animate-pulse rounded bg-slate-100"}),e.jsx("div",{className:"mt-3 h-4 w-80 animate-pulse rounded bg-slate-100"}),e.jsx("div",{className:"mt-6 grid gap-3 sm:grid-cols-2",children:Array.from({length:4}).map((t,s)=>e.jsx("div",{className:"h-20 animate-pulse rounded-2xl border border-slate-200 bg-white"},s))}),e.jsx("div",{className:"mt-6 h-64 animate-pulse rounded-2xl border border-slate-200 bg-white"})]});return e.jsxs(le,{title:"Construction",active:"workers",items:K,children:[e.jsx(re,{title:"Construction Workers"}),e.jsxs("div",{className:"border-b border-slate-200 px-6 py-4",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Workers"}),e.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:"Manage groups (companies/individuals) and assign them to projects."}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>N("all"),className:"rounded-xl px-4 py-2 text-[12px] font-semibold transition "+(y==="all"?"bg-slate-900 text-white":"border border-slate-200 bg-white text-slate-900 hover:bg-slate-50"),children:"All workers"}),e.jsx("button",{type:"button",onClick:()=>N("create"),className:"rounded-xl px-4 py-2 text-[12px] font-semibold transition "+(y==="create"?"bg-slate-900 text-white":"border border-slate-200 bg-white text-slate-900 hover:bg-slate-50"),children:"Add group"})]})]}),e.jsxs("div",{className:"p-6",children:[C?e.jsx("div",{className:"mb-4 rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-[12px] text-rose-700",children:C}):null,y==="create"?e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Add group"}),e.jsx("div",{className:"mt-1 text-[12px] text-slate-600",children:"Create a company/individual group, then add workers and assign to projects."}),e.jsxs("div",{className:"mt-5 grid gap-3 sm:grid-cols-3",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsxs("label",{className:"text-[11px] font-semibold text-slate-700",children:["Group name ",e.jsx("span",{className:"text-rose-600",children:"*"})]}),e.jsx("input",{value:u.name,onChange:t=>w(s=>({...s,name:t.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]",placeholder:"e.g. ABC Contractors Ltd"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[11px] font-semibold text-slate-700",children:["Type ",e.jsx("span",{className:"text-rose-600",children:"*"})]}),e.jsxs("select",{value:u.type,onChange:t=>w(s=>({...s,type:t.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]",children:[e.jsx("option",{value:"company",children:"Company"}),e.jsx("option",{value:"individual",children:"Individual"})]})]})]}),e.jsx("div",{className:"mt-6 flex items-center justify-end",children:e.jsx("button",{type:"button",onClick:z,disabled:m,className:"rounded-xl bg-slate-900 px-5 py-2.5 text-[12px] font-semibold text-white shadow-sm hover:bg-slate-800 disabled:opacity-60",children:"Save group"})})]}):e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[320px,1fr]",children:[e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 border-b border-slate-200 bg-slate-50 px-4 py-3",children:[e.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:"Groups"}),e.jsx("button",{type:"button",onClick:j,disabled:A,className:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px] font-semibold text-slate-900 hover:bg-slate-50 disabled:opacity-60",children:"Refresh"})]}),A?se:e.jsxs("div",{className:"p-2",children:[S.length?null:e.jsx("div",{className:"p-4 text-[12px] text-slate-500",children:"No groups yet. Use “Add group”."}),e.jsx("div",{className:"grid gap-1",children:S.map(t=>{const s=String(o)===String(t.id);return e.jsxs("button",{type:"button",onClick:()=>D(String(t.id)),className:"flex w-full items-center justify-between rounded-xl px-3 py-2 text-left text-[12px] font-semibold transition "+(s?"bg-slate-900 text-white":"text-slate-900 hover:bg-slate-50"),children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate",children:t.name}),e.jsxs("div",{className:"mt-0.5 text-[11px] font-semibold "+(s?"text-white/80":"text-slate-500"),children:[t.type," • ",t.workers_count," worker(s)"]})]}),e.jsx("div",{className:"h-2 w-2 rounded-full "+(s?"bg-white":"bg-slate-300")})]},t.id)})})]})]}),e.jsx("div",{className:"overflow-hidden rounded-2xl border border-slate-200 bg-white",children:L?ae:v?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b border-slate-200 px-6 py-4",children:[e.jsxs("div",{className:"flex flex-wrap items-end justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:v.name}),e.jsxs("div",{className:"mt-1 text-[12px] text-slate-500",children:["Group type: ",v.type]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsxs("select",{value:f,onChange:t=>W(t.target.value),className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px] sm:w-72",children:[e.jsx("option",{value:"",children:"Assign to project…"}),I.map(t=>e.jsxs("option",{value:t.id,children:[t.code?`${t.code} - `:"",t.name]},t.id))]}),e.jsx("button",{type:"button",onClick:Y,disabled:m||!f,className:"rounded-xl bg-slate-900 px-4 py-2 text-[12px] font-semibold text-white shadow-sm hover:bg-slate-800 disabled:opacity-60",children:"Assign"})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[O.length?null:e.jsx("div",{className:"text-[12px] text-slate-500",children:"Not assigned to any project."}),O.map(t=>e.jsxs("button",{type:"button",onClick:()=>Z(t),className:"inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-[12px] font-semibold text-slate-700 hover:bg-slate-50",title:"Click to remove",children:[e.jsxs("span",{className:"truncate",children:[t.code?`${t.code}: `:"",t.name]}),e.jsx("span",{className:"text-slate-400",children:"×"})]},t.id))]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-5",children:[e.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:"Add worker"}),e.jsx("div",{className:"mt-1 text-[11px] text-slate-600",children:"Add individual worker into this group."}),e.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-5",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsxs("label",{className:"text-[11px] font-semibold text-slate-700",children:["Full name ",e.jsx("span",{className:"text-rose-600",children:"*"})]}),e.jsx("input",{value:i.name,onChange:t=>h(s=>({...s,name:t.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]",placeholder:"Worker name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Age"}),e.jsx("input",{value:i.age,onChange:t=>h(s=>({...s,age:t.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]",placeholder:"e.g. 28"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"DOB"}),e.jsx("input",{type:"date",value:i.date_of_birth,onChange:t=>h(s=>({...s,date_of_birth:t.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"NIDA"}),e.jsx("input",{value:i.nida,onChange:t=>h(s=>({...s,nida:t.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]",placeholder:"NIDA number"})]})]}),e.jsx("div",{className:"mt-4 flex items-center justify-end",children:e.jsx("button",{type:"button",onClick:V,disabled:m,className:"rounded-xl bg-slate-900 px-4 py-2 text-[12px] font-semibold text-white hover:bg-slate-800 disabled:opacity-60",children:"Add worker"})})]}),e.jsxs("div",{className:"mt-6 overflow-hidden rounded-2xl border border-slate-200 bg-white",children:[e.jsx("div",{className:"border-b border-slate-200 bg-slate-50 px-4 py-3",children:e.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:"Workers"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:"Name"}),e.jsx("th",{className:"w-24 px-4 py-3 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:"Age"}),e.jsx("th",{className:"w-32 px-4 py-3 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:"DOB"}),e.jsx("th",{className:"w-44 px-4 py-3 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:"NIDA"}),e.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:"Documents"}),e.jsx("th",{className:"w-24 px-4 py-3 text-right text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:"Action"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-200 bg-white",children:[R.length?null:e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-10 text-center text-[12px] text-slate-500",children:"No workers in this group."})}),R.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-3 text-[12px] font-semibold text-slate-900",children:t.name}),e.jsx("td",{className:"px-4 py-3 text-[12px] text-slate-700",children:t.age??"-"}),e.jsx("td",{className:"px-4 py-3 text-[12px] text-slate-700",children:t.date_of_birth||"-"}),e.jsx("td",{className:"px-4 py-3 text-[12px] text-slate-700",children:t.nida||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(t.documents||{}).map(([s,a])=>e.jsxs("button",{type:"button",onClick:()=>ee(t,a),className:"inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-[11px] font-semibold "+U(a.status),children:[e.jsx("span",{className:"h-2 w-2 rounded-full "+B(a.status)}),e.jsx("span",{children:F[s]||s})]},s))})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{type:"button",onClick:()=>Q(t),disabled:m,className:"rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-[12px] font-semibold text-rose-700 hover:bg-rose-100 disabled:opacity-60",children:"Delete"})})]},t.id))]})]})})]})]})]}):e.jsx("div",{className:"p-6 text-[12px] text-slate-500",children:"Select a group to view workers."})})]}),J?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("button",{type:"button",className:"absolute inset-0 bg-slate-900/40",onClick:k,"aria-label":"Close"}),e.jsxs("div",{className:"relative w-full max-w-lg overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-xl",children:[e.jsxs("div",{className:"border-b border-slate-200 px-5 py-4",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Document verification"}),e.jsxs("div",{className:"mt-1 text-[12px] text-slate-600",children:[b?.worker?.name," • ",F[b?.doc?.type]||b?.doc?.type]})]}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Status"}),e.jsxs("select",{value:c.status,onChange:t=>g(s=>({...s,status:t.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Expiry date"}),e.jsx("input",{type:"date",value:c.expiry_date,onChange:t=>g(s=>({...s,expiry_date:t.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Notes"}),e.jsx("textarea",{value:c.notes,onChange:t=>g(s=>({...s,notes:t.target.value})),rows:4,className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px]",placeholder:"Optional notes..."})]})]}),e.jsxs("div",{className:"mt-5 flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:k,className:"rounded-xl border border-slate-200 bg-white px-4 py-2 text-[12px] font-semibold text-slate-900 hover:bg-slate-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:te,disabled:m,className:"rounded-xl bg-slate-900 px-4 py-2 text-[12px] font-semibold text-white hover:bg-slate-800 disabled:opacity-60",children:"Save"})]})]})]})]}):null]})]})}export{pe as default};
