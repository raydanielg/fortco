import{r as l,j as t,H as X}from"./app-_tcWvRHw.js";import{C as B}from"./ConstructionPanelLayout-smiwN9nJ.js";import"./DashboardLayout-Dotb40vo.js";import"./AnimatedIcon-D_as9RWF.js";import"./index-D3vds0s7.js";import"./index-DoyJDsUh.js";function U(){const[a,o]=l.useState(!1),[g,n]=l.useState(""),[r,w]=l.useState([]),[x,N]=l.useState(""),[i,v]=l.useState("all"),[c,u]=l.useState({}),[k,p]=l.useState(""),j=()=>document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",b=async e=>{const s=await e.text();try{return s?JSON.parse(s):{}}catch{return{}}},f=l.useMemo(()=>{const e=new URLSearchParams;x&&e.set("q",x),i&&i!=="all"&&e.set("status",i);const s=e.toString();return s?`?${s}`:""},[x,i]),m=()=>{o(!0),n(""),fetch(route("admin.construction.projects.data")+f,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(async e=>{const s=await b(e);if(!e.ok)throw new Error(s?.message||"Failed to load projects");w(Array.isArray(s?.projects)?s.projects:[])}).catch(e=>n(e?.message||"Failed to load projects")).finally(()=>o(!1))};l.useEffect(()=>{m()},[]),l.useEffect(()=>{m()},[f]);const S=l.useMemo(()=>[{value:"all",label:"All statuses"},{value:"planned",label:"Planned"},{value:"in_progress",label:"In progress"},{value:"on_hold",label:"On hold"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],[]),d=l.useMemo(()=>Object.keys(c).filter(e=>c[e]).map(e=>Number(e)).filter(Boolean),[c]),C=l.useMemo(()=>r.length?r.every(e=>c[String(e.id)]):!1,[r,c]),E=e=>{if(!r.length)return;const s={};r.forEach(h=>{s[String(h.id)]=e}),u(s)},P=e=>{u(s=>({...s,[String(e)]:!s[String(e)]}))},R=()=>{d.length&&window.confirm(`Delete ${d.length} project(s)? This cannot be undone.`)&&(o(!0),n(""),fetch(route("admin.construction.projects.bulk-destroy"),{method:"DELETE",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":j(),Accept:"application/json"},body:JSON.stringify({ids:d})}).then(async e=>{const s=await b(e);if(!e.ok)throw new Error(s?.message||"Bulk delete failed");u({}),m()}).catch(e=>n(e?.message||"Bulk delete failed")).finally(()=>o(!1)))},L=e=>{e?.id&&(window.location.href=route("admin.construction.projects")+`?view=${encodeURIComponent(String(e.id))}`)},q=e=>{e?.id&&(window.location.href=route("admin.construction.projects")+`?progress=${encodeURIComponent(String(e.id))}`)},A=e=>{e?.id&&window.confirm(`Delete ${e.name}? This cannot be undone.`)&&(o(!0),n(""),fetch(route("admin.construction.projects.destroy",{project:e.id}),{method:"DELETE",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":j(),Accept:"application/json"}}).then(async s=>{const h=await b(s);if(!s.ok)throw new Error(h?.message||"Delete failed");p(""),u(O=>{const y={...O};return delete y[String(e.id)],y}),m()}).catch(s=>n(s?.message||"Delete failed")).finally(()=>o(!1)))},M=()=>{const e=route("admin.construction.projects.export")+f;window.location.href=e},D=()=>{window.location.href=route("admin.construction.projects.create")};return t.jsxs(B,{title:"Construction",active:"projects",items:[{key:"projects",label:"Projects",href:route("admin.construction.projects")},{key:"create",label:"Create Projects",href:route("admin.construction.projects.create")},{key:"categories",label:"Project Categories",href:route("admin.construction.project-categories")},{key:"locations",label:"Locations",href:route("admin.construction.locations")},{key:"materials",label:"Materials",href:route("admin.construction.materials")},{key:"workers",label:"Workers",href:route("admin.construction.workers")}],children:[t.jsx(X,{title:"Construction Projects"}),t.jsxs("div",{className:"border-b border-slate-200 px-6 py-4",children:[t.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Projects"}),t.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:"Manage construction projects with filters, bulk actions and export."})]}),t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-end lg:justify-between",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Projects"}),t.jsx("div",{className:"mt-1 text-[12px] text-slate-600",children:"Search, filter, export and manage projects."})]}),t.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end",children:[t.jsx("button",{type:"button",onClick:D,disabled:a,className:"inline-flex items-center justify-center rounded-xl bg-slate-900 px-3 py-2 text-[12px] font-semibold text-white shadow-sm hover:bg-slate-800 disabled:opacity-60",children:"Create Project"}),t.jsx("button",{type:"button",onClick:M,disabled:a,className:"inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px] font-semibold text-slate-900 shadow-sm hover:bg-slate-50 disabled:opacity-60",children:"Export Excel"})]})]}),t.jsxs("div",{className:"mt-5 grid gap-3 lg:grid-cols-12",children:[t.jsxs("div",{className:"lg:col-span-6",children:[t.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Search"}),t.jsx("input",{value:x,onChange:e=>N(e.target.value),placeholder:"Search by name or code...",className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px] text-slate-900 placeholder:text-slate-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20"})]}),t.jsxs("div",{className:"lg:col-span-3",children:[t.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Status"}),t.jsx("select",{value:i,onChange:e=>v(e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px] text-slate-900 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20",children:S.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{className:"lg:col-span-3",children:[t.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Bulk actions"}),t.jsxs("button",{type:"button",onClick:R,disabled:a||!d.length,className:"mt-1 w-full rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-[12px] font-semibold text-rose-700 hover:bg-rose-100 disabled:opacity-60",children:["Bulk delete (",d.length,")"]})]})]}),g?t.jsx("div",{className:"mt-4 rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-[12px] text-rose-700",children:g}):null,t.jsx("div",{className:"mt-5 overflow-hidden rounded-2xl border border-slate-200 bg-white",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-slate-200",children:[t.jsx("thead",{className:"bg-slate-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"w-10 px-4 py-3 text-left",children:t.jsx("input",{type:"checkbox",checked:C,onChange:e=>E(e.target.checked),className:"h-4 w-4 rounded border-slate-300 text-slate-900 focus:ring-slate-900"})}),t.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:"Code"}),t.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:"Name"}),t.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:"Status"}),t.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:"Start"}),t.jsx("th",{className:"px-4 py-3 text-left text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:"End"}),t.jsx("th",{className:"px-4 py-3 text-right text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:"Budget"}),t.jsx("th",{className:"w-12 px-4 py-3 text-right text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:"Action"})]})}),t.jsxs("tbody",{className:"divide-y divide-slate-200 bg-white",children:[a&&!r.length?t.jsx("tr",{children:t.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-[12px] text-slate-500",children:"Loading..."})}):null,!a&&!r.length?t.jsx("tr",{children:t.jsx("td",{colSpan:8,className:"px-4 py-10 text-center text-[12px] text-slate-500",children:"No projects found."})}):null,r.map(e=>t.jsxs("tr",{className:"hover:bg-slate-50",children:[t.jsx("td",{className:"px-4 py-3",children:t.jsx("input",{type:"checkbox",checked:!!c[String(e.id)],onChange:()=>P(e.id),className:"h-4 w-4 rounded border-slate-300 text-slate-900 focus:ring-slate-900"})}),t.jsx("td",{className:"px-4 py-3 text-[12px] font-medium text-slate-900",children:e.code||"-"}),t.jsx("td",{className:"px-4 py-3 text-[12px] text-slate-900",children:e.name}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("span",{className:"inline-flex items-center rounded-full border border-slate-200 bg-white px-2 py-1 text-[11px] font-semibold text-slate-700",children:String(e.status||"").replace(/_/g," ")||"-"})}),t.jsx("td",{className:"px-4 py-3 text-[12px] text-slate-600",children:e.start_date||"-"}),t.jsx("td",{className:"px-4 py-3 text-[12px] text-slate-600",children:e.end_date||"-"}),t.jsx("td",{className:"px-4 py-3 text-right text-[12px] text-slate-900",children:e.budget!==null&&e.budget!==void 0&&e.budget!==""?Number(e.budget).toLocaleString():"-"}),t.jsxs("td",{className:"relative px-4 py-3 text-right",children:[t.jsx("button",{type:"button",onClick:()=>p(s=>String(s)===String(e.id)?"":String(e.id)),className:"inline-flex h-8 w-8 items-center justify-center rounded-lg border border-slate-200 bg-white text-slate-700 shadow-sm hover:bg-slate-50","aria-label":"Actions",children:t.jsx("span",{className:"text-lg leading-none",children:"â‹¯"})}),String(k)===String(e.id)?t.jsxs("div",{className:"absolute right-4 top-12 z-20 w-44 overflow-hidden rounded-xl border border-slate-200 bg-white shadow-lg",children:[t.jsx("button",{type:"button",onClick:()=>{p(""),q(e)},className:"block w-full px-4 py-2 text-left text-[12px] font-semibold text-slate-700 hover:bg-slate-50",children:"Progress"}),t.jsx("button",{type:"button",onClick:()=>{p(""),L(e)},className:"block w-full px-4 py-2 text-left text-[12px] font-semibold text-slate-700 hover:bg-slate-50",children:"View"}),t.jsx("button",{type:"button",onClick:()=>A(e),className:"block w-full px-4 py-2 text-left text-[12px] font-semibold text-rose-700 hover:bg-rose-50",children:"Delete"})]}):null]})]},e.id))]})]})})}),t.jsxs("div",{className:"mt-3 flex items-center justify-between text-[11px] text-slate-500",children:[t.jsxs("div",{children:["Showing ",r.length," project(s)"]}),t.jsx("div",{children:a?"Updating...":"Live"})]})]})]})}export{U as default};
