import{r as a,j as e}from"./app-Be5uCMNC.js";import V from"./SettingsSectionShell-BKQE600h.js";import{F as J}from"./CircleStackIcon-Cph6t4XK.js";import{F as q}from"./ArrowPathIcon--9mEof5Y.js";import{F as U}from"./TrashIcon-DsEoxDs0.js";function _({title:n,titleId:i,...d},l){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":i},d),n?a.createElement("title",{id:i},n):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"}))}const I=a.forwardRef(_);function Z({title:n,titleId:i,...d},l){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":i},d),n?a.createElement("title",{id:i},n):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"}))}const B=a.forwardRef(Z);function ae(){const[n,i]=a.useState("backup"),[d,l]=a.useState(!1),[y,r]=a.useState(""),[k,A]=a.useState([]),[f,M]=a.useState(""),[c,C]=a.useState(null),[O,p]=a.useState(!1),[j,b]=a.useState({open:!1,name:""}),[T,g]=a.useState(!1),[x,N]=a.useState("idle"),[w,S]=a.useState(""),E=f==="sqlite"?".sqlite":".sql",R=t=>"inline-flex items-center border-b-2 px-4 py-3 text-[12px] font-semibold transition "+(t?"border-slate-900 text-slate-900":"border-transparent text-slate-500 hover:text-slate-900"),u=async t=>{const s=await t.text();try{return s?JSON.parse(s):{}}catch{return{}}},X=()=>T?e.jsxs("div",{className:"fixed inset-0 z-[80] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>x!=="running"&&g(!1)}),e.jsxs("div",{className:"relative w-full max-w-md rounded-2xl border border-slate-200 bg-white p-5 shadow-2xl",children:[e.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:"Export Database"}),e.jsx("div",{className:"mt-2 text-[12px] text-slate-600",children:x==="running"?"Execution running… exporting tables and data.":x==="done"?"Export completed.":"Ready."}),x==="running"?e.jsx("div",{className:"mt-4 rounded-xl border border-slate-200 bg-slate-50 p-4 text-[12px] text-slate-600",children:"Please wait…"}):x==="done"&&w?e.jsxs("div",{className:"mt-4 rounded-xl border border-slate-200 bg-white p-4",children:[e.jsx("div",{className:"font-mono text-[11px] font-semibold text-slate-900 break-all",children:w}),e.jsx("a",{href:route("admin.database-backups.download",{file:w}),className:"mt-3 inline-flex items-center justify-center rounded-xl bg-slate-900 px-5 py-2.5 text-[12px] font-semibold text-white hover:bg-slate-800",children:"Download backup"})]}):null,e.jsx("div",{className:"mt-5 flex items-center justify-end gap-2",children:e.jsx("button",{type:"button",onClick:()=>g(!1),disabled:x==="running",className:"rounded-xl border border-slate-200 bg-white px-4 py-2 text-[12px] font-semibold text-slate-700 hover:bg-slate-50 disabled:opacity-50",children:"Close"})})]})]}):null,L=()=>j.open?e.jsxs("div",{className:"fixed inset-0 z-[80] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>b({open:!1,name:""})}),e.jsxs("div",{className:"relative w-full max-w-md rounded-2xl border border-slate-200 bg-white p-5 shadow-2xl",children:[e.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:"Delete Backup"}),e.jsxs("div",{className:"mt-2 text-[12px] text-slate-600 break-all",children:["Delete ",e.jsx("span",{className:"font-semibold text-slate-900",children:j.name}),"?"]}),e.jsxs("div",{className:"mt-5 flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>b({open:!1,name:""}),className:"rounded-xl border border-slate-200 bg-white px-4 py-2 text-[12px] font-semibold text-slate-700 hover:bg-slate-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:()=>{const t=j.name;b({open:!1,name:""}),t&&z(t)},className:"rounded-xl bg-red-600 px-4 py-2 text-[12px] font-semibold text-white hover:bg-red-500",children:"Delete"})]})]})]}):null,m=()=>{l(!0),r(""),fetch(route("admin.database-backups.index"),{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(async t=>{const s=await u(t);if(!t.ok)throw new Error(s?.message||"Failed to load backups");M(String(s?.driver||"")),A(Array.isArray(s?.files)?s.files:[])}).catch(t=>r(t?.message||"Failed to load backups")).finally(()=>l(!1))};a.useEffect(()=>{m()},[]);const $=()=>{g(!0),N("running"),S(""),l(!0),r(""),fetch(route("admin.database-backups.generate"),{method:"POST",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"}}).then(async t=>{const s=await u(t);if(!t.ok)throw new Error(s?.message||"Generate failed");N("done"),S(String(s?.file||"")),m()}).catch(t=>{N("idle"),r(t?.message||"Generate failed")}).finally(()=>l(!1))},W=t=>{b({open:!0,name:t})},z=t=>{l(!0),r(""),fetch(route("admin.database-backups.destroy",{file:t}),{method:"DELETE",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"}}).then(async s=>{const o=await u(s);if(!s.ok)throw new Error(o?.message||"Delete failed");m()}).catch(s=>r(s?.message||"Delete failed")).finally(()=>l(!1))},H=()=>{if(!c){r("Please choose a .sql backup file");return}p(!0)},K=()=>{if(!c)return;l(!0),r("");const t=new FormData;t.append("backup",c),fetch(route("admin.database-backups.restore"),{method:"POST",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"},body:t}).then(async s=>{const o=await u(s);if(!s.ok)throw new Error(o?.message||"Restore failed");C(null),m()}).catch(s=>r(s?.message||"Restore failed")).finally(()=>l(!1))},D=t=>{t&&(r(""),C(t),i("restore"))},P=t=>{const s=Number(t||0);if(!s)return"0 B";const o=["B","KB","MB","GB"];let v=s,h=0;for(;v>=1024&&h<o.length-1;)v/=1024,h++;return`${v.toFixed(h===0?0:2)} ${o[h]}`},G=()=>O?e.jsxs("div",{className:"fixed inset-0 z-[80] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>p(!1)}),e.jsxs("div",{className:"relative w-full max-w-md rounded-2xl border border-slate-200 bg-white p-5 shadow-2xl",children:[e.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:"Restore Database"}),e.jsx("div",{className:"mt-2 text-[12px] text-slate-600",children:"This will overwrite current database data. Make sure you have a recent backup."}),e.jsxs("div",{className:"mt-5 flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>p(!1),className:"rounded-xl border border-slate-200 bg-white px-4 py-2 text-[12px] font-semibold text-slate-700 hover:bg-slate-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:()=>{p(!1),K()},className:"rounded-xl bg-red-600 px-4 py-2 text-[12px] font-semibold text-white hover:bg-red-500",children:"Confirm Restore"})]})]})]}):null,F=a.useMemo(()=>k,[k]);return e.jsx(V,{title:"",description:"",children:e.jsxs("div",{className:"-m-5 overflow-hidden rounded-2xl border border-slate-200 bg-white",children:[e.jsxs("div",{className:"border-b border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 px-6",children:[e.jsxs("div",{className:"my-3 inline-flex items-center gap-2 text-[12px] font-semibold text-slate-900",children:[e.jsx(J,{className:"h-5 w-5"}),"Database Backup"]}),e.jsx("div",{className:"my-3 text-[12px] text-slate-500",children:d?"Working…":f?`Driver: ${f}`:""})]}),e.jsxs("div",{className:"flex items-center gap-1 px-2",children:[e.jsx("button",{type:"button",onClick:()=>i("backup"),className:R(n==="backup"),children:"Backup"}),e.jsx("button",{type:"button",onClick:()=>i("restore"),className:R(n==="restore"),children:"Restore"})]})]}),y?e.jsx("div",{className:"border-b border-slate-200 bg-red-50 px-6 py-3 text-[12px] text-red-700",children:y}):null,e.jsxs("div",{className:"p-6",children:[n==="backup"?e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("button",{type:"button",onClick:$,className:"inline-flex items-center gap-2 rounded-xl bg-slate-900 px-5 py-2.5 text-[12px] font-semibold text-white hover:bg-slate-800",children:[e.jsx(q,{className:"h-4 w-4"}),"Export Database"]}),e.jsxs("button",{type:"button",onClick:m,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-4 py-2 text-[12px] font-semibold text-slate-700 hover:bg-slate-50",children:[e.jsx(q,{className:`h-4 w-4 ${d?"animate-spin":""}`}),"Refresh"]})]}),e.jsx("div",{className:"mt-4 overflow-hidden rounded-xl border border-slate-200 bg-white",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{className:"text-left text-[12px] font-semibold text-slate-700",children:[e.jsx("th",{className:"px-4 py-3",children:"File"}),e.jsx("th",{className:"px-4 py-3",children:"Size"}),e.jsx("th",{className:"px-4 py-3",children:"Modified"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:F.length?F.map(t=>e.jsxs("tr",{className:"text-[12px] text-slate-700",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"font-mono text-[11px] font-semibold text-slate-900 break-all",children:t.name})}),e.jsx("td",{className:"px-4 py-3 text-slate-500",children:P(t.size)}),e.jsx("td",{className:"px-4 py-3 text-slate-500",children:t.modified_at}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs("a",{href:route("admin.database-backups.download",{file:t.name}),className:"inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-[11px] font-semibold text-slate-700 hover:bg-slate-50",children:[e.jsx(I,{className:"h-4 w-4"}),"Download"]}),e.jsxs("button",{type:"button",onClick:()=>W(t.name),className:"inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-[11px] font-semibold text-red-700 hover:bg-red-50",children:[e.jsx(U,{className:"h-4 w-4"}),"Delete"]})]})})]},t.name)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-6 text-[12px] text-slate-500",children:"No backups yet."})})})]})}),e.jsxs("div",{className:"mt-4 text-[12px] text-slate-500",children:["Backups are stored in ",e.jsx("span",{className:"font-semibold text-slate-700",children:"storage/app/private/db_backups"}),"."]})]}):e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-[12px] text-slate-600",children:["Upload a ",e.jsx("span",{className:"font-semibold text-slate-900",children:E})," backup file to restore. This will overwrite current data."]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-4",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wider text-slate-500",children:"Backup file (.sql)"}),e.jsx("div",{className:"mt-3 rounded-xl border-2 border-dashed border-slate-200 bg-slate-50 p-6",onDragOver:t=>{t.preventDefault()},onDrop:t=>{t.preventDefault(),D(t.dataTransfer?.files?.[0]||null)},children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 text-center",children:[e.jsx(B,{className:"h-6 w-6 text-slate-500"}),e.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:"Drag & drop file here"}),e.jsx("div",{className:"text-[12px] text-slate-600",children:"or choose a file"}),e.jsx("input",{type:"file",accept:E,onChange:t=>D(t.target.files?.[0]||null),className:"text-[12px]"})]})}),c?e.jsxs("div",{className:"mt-3 text-[12px] text-slate-600",children:["Selected: ",e.jsx("span",{className:"font-semibold text-slate-900",children:c.name})]}):null,e.jsx("div",{className:"mt-4 flex items-center justify-end",children:e.jsxs("button",{type:"button",onClick:H,disabled:!c,className:"inline-flex items-center gap-2 rounded-xl bg-red-600 px-5 py-2.5 text-[12px] font-semibold text-white hover:bg-red-500 disabled:opacity-50",children:[e.jsx(B,{className:"h-4 w-4"}),"Import Data"]})})]})]}),e.jsx(G,{}),e.jsx(L,{}),e.jsx(X,{})]})]})})}export{ae as default};
