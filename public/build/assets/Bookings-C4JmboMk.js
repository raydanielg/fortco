import{r as o,j as e,H as D}from"./app-_tcWvRHw.js";import{R as P}from"./RealEstatePanelLayout-MWmKt_Sl.js";import"./DashboardLayout-Dotb40vo.js";import"./AnimatedIcon-D_as9RWF.js";import"./index-D3vds0s7.js";import"./index-DoyJDsUh.js";function K(){const[n,b]=o.useState("requests"),[g,f]=o.useState(!0),[m,x]=o.useState(!1),[y,i]=o.useState(""),[u,E]=o.useState(""),[w,S]=o.useState([]),[r,a]=o.useState(null),j=()=>document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",h=async t=>{const s=await t.text();try{return s?JSON.parse(s):{}}catch{return{}}},C=(t,s)=>{const l=t.currentTarget.getBoundingClientRect(),d=176,v=140,c=8,z=Math.min(Math.max(c,l.right-d),window.innerWidth-d-c),A=l.bottom+c+v<=window.innerHeight?l.bottom+c:Math.max(c,l.top-v-c),k={id:s.id,top:A,left:z};a(F=>F?.id===k.id?null:k)},N=(t,s)=>{x(!0),i(""),fetch(route("admin.real-estate.bookings.status",t),{method:"PUT",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":j()},body:JSON.stringify({status:s})}).then(async l=>{const d=await h(l);if(!l.ok)throw new Error(d?.message||"Failed to update status");p()}).catch(l=>i(l?.message||"Failed to update status")).finally(()=>x(!1))},R=o.useMemo(()=>[{key:"properties",label:"Properties",href:route("admin.real-estate.properties")},{key:"bookings",label:"Bookings",href:route("admin.real-estate.bookings")},{key:"clients",label:"Clients",href:route("admin.real-estate.clients")}],[]),L=t=>{const s=String(t||"ongoing");return s==="completed"?"border-emerald-200 bg-emerald-50 text-emerald-700":s==="ongoing"?"border-amber-200 bg-amber-50 text-amber-700":"border-slate-200 bg-slate-50 text-slate-700"},M=t=>{const s=String(t||"ongoing");return s==="completed"?"bg-emerald-500":s==="ongoing"?"bg-amber-500 animate-pulse":"bg-slate-500"},q=t=>String(t||"ongoing").replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase()),p=()=>{f(!0),i("");const t=new URL(route("admin.real-estate.bookings.data"));u.trim()&&t.searchParams.set("q",u.trim()),t.searchParams.set("status",n==="completed"?"completed":"ongoing"),fetch(t.toString(),{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(async s=>{const l=await h(s);if(!s.ok)throw new Error(l?.message||"Failed to load bookings");S(Array.isArray(l?.bookings)?l.bookings:[])}).catch(s=>i(s?.message||"Failed to load bookings")).finally(()=>f(!1))};o.useEffect(()=>{p()},[]),o.useEffect(()=>{p(),a(null)},[n]),o.useEffect(()=>{const t=()=>a(null),s=()=>a(null),l=d=>{d.key==="Escape"&&a(null)};return window.addEventListener("scroll",t,!0),window.addEventListener("resize",s),window.addEventListener("keydown",l),()=>{window.removeEventListener("scroll",t,!0),window.removeEventListener("resize",s),window.removeEventListener("keydown",l)}},[]);const B=t=>{confirm("Delete this booking?")&&(x(!0),i(""),fetch(route("admin.real-estate.bookings.destroy",t),{method:"DELETE",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":j()}}).then(async s=>{const l=await h(s);if(!s.ok)throw new Error(l?.message||"Failed to delete booking");p()}).catch(s=>i(s?.message||"Failed to delete booking")).finally(()=>x(!1)))};return e.jsxs(P,{title:"Real Estate",active:"bookings",items:R,children:[e.jsx(D,{title:"Real Estate - Bookings"}),e.jsx("div",{className:"border-b border-slate-200 px-6 py-4",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Bookings"}),e.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:"Track requests and mark them as completed."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>b("requests"),className:"rounded-xl px-4 py-2 text-[12px] font-semibold "+(n==="requests"?"bg-slate-900 text-white":"border border-slate-200 bg-white text-slate-900 hover:bg-slate-50"),children:"All Requests"}),e.jsx("button",{type:"button",onClick:()=>b("completed"),className:"rounded-xl px-4 py-2 text-[12px] font-semibold "+(n==="completed"?"bg-slate-900 text-white":"border border-slate-200 bg-white text-slate-900 hover:bg-slate-50"),children:"Completed Results"})]})]})}),e.jsxs("div",{className:"p-6",children:[y?e.jsx("div",{className:"mb-4 rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-[12px] text-rose-700",children:y}):null,e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 border-b border-slate-200 bg-slate-50 px-4 py-3",children:[e.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:n==="completed"?"Completed results":"All requests"}),e.jsxs("div",{className:"flex flex-1 flex-col gap-2 sm:flex-row sm:items-center sm:justify-end",children:[e.jsxs("div",{className:"relative w-full sm:w-96",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-slate-400",children:e.jsx("svg",{viewBox:"0 0 24 24",className:"h-4 w-4",fill:"none",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-4.3-4.3m1.8-4.7a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{value:u,onChange:t=>E(t.target.value),className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 pl-9 text-[12px]",placeholder:"Search property, customer, phone, status"})]}),e.jsx("button",{type:"button",onClick:p,disabled:g,className:"rounded-xl border border-slate-200 bg-white px-4 py-2 text-[12px] font-semibold text-slate-900 hover:bg-slate-50 disabled:opacity-60",children:"Search"})]})]}),e.jsx("div",{className:"overflow-x-auto bg-white",children:e.jsxs("table",{className:"min-w-full text-left text-[12px]",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"px-4 py-3 font-semibold text-slate-700",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-slate-700",children:"Phone"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-slate-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-slate-700",children:"Property"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-slate-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-slate-700",children:"Received"}),e.jsx("th",{className:"w-16 px-4 py-3 font-semibold text-slate-700"})]})}),e.jsx("tbody",{children:g?Array.from({length:7}).map((t,s)=>e.jsx("tr",{className:"border-b border-slate-100",children:e.jsx("td",{className:"px-4 py-3",colSpan:7,children:e.jsx("div",{className:"h-4 w-full animate-pulse rounded bg-slate-100"})})},s)):w.length?w.map(t=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-slate-900",children:t.full_name}),e.jsx("td",{className:"px-4 py-3 text-slate-700",children:t.phone_number}),e.jsx("td",{className:"px-4 py-3 text-slate-700",children:t.email||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-11 w-16 overflow-hidden rounded-xl border border-slate-200 bg-slate-100",children:t.property?.image?e.jsx("img",{src:t.property.image,alt:"",className:"h-full w-full object-cover"}):null}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold text-slate-900 line-clamp-1",children:t.property?.title||t.property_title||"-"}),e.jsx("div",{className:"text-[11px] font-semibold text-slate-500 line-clamp-1",children:(t.property?.location||"")+(t.property?.price?` Â· ${t.property.price}`:"")})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full border px-2.5 py-1 font-semibold ${L(t.status)}`,children:[e.jsx("span",{className:`h-2 w-2 rounded-full ${M(t.status)}`}),q(t.status)]})}),e.jsx("td",{className:"px-4 py-3 text-slate-700",children:t.created_at?new Date(t.created_at).toLocaleString():"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{type:"button",onClick:s=>C(s,t),className:"inline-flex h-8 w-8 items-center justify-center rounded-lg border border-slate-200 bg-white hover:bg-slate-50",children:e.jsx("svg",{viewBox:"0 0 24 24",className:"h-4 w-4",fill:"none",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zM12 13.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zM12 20.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})})})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-8 text-center text-slate-500",colSpan:7,children:"No bookings found"})})})]})})]}),r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>a(null)}),e.jsxs("div",{className:"fixed z-50 w-44 overflow-hidden rounded-xl border border-slate-200 bg-white shadow-lg",style:{top:r.top,left:r.left},children:[e.jsx("button",{type:"button",onClick:()=>{a(null),window.location.href=route("admin.real-estate.bookings.show",r.id)},className:"block w-full px-4 py-2 text-left text-[12px] hover:bg-slate-50",children:"View"}),n==="completed"?e.jsx("button",{type:"button",disabled:m,onClick:()=>{const t=r.id;a(null),N(t,"ongoing")},className:"block w-full px-4 py-2 text-left text-[12px] hover:bg-slate-50 disabled:opacity-60",children:"Mark as Ongoing"}):e.jsx("button",{type:"button",disabled:m,onClick:()=>{const t=r.id;a(null),N(t,"completed")},className:"block w-full px-4 py-2 text-left text-[12px] hover:bg-slate-50 disabled:opacity-60",children:"Mark as Completed"}),e.jsx("button",{type:"button",disabled:m,onClick:()=>{const t=r.id;a(null),B(t)},className:"block w-full px-4 py-2 text-left text-[12px] text-rose-700 hover:bg-rose-50 disabled:opacity-60",children:"Delete"})]})]}):null]})]})}export{K as default};
